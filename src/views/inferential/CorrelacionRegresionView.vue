<template>
  <div class="correlacion-regresion-view">
    <div class="container">
      <div class="hero">
        <h1>Correlaci√≥n y Regresi√≥n Lineal</h1>
        <p>
          Descubre c√≥mo se relacionan dos variables y aprende a hacer predicciones basadas en datos
          reales
        </p>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button
          v-for="tab in tabs"
          :key="tab.id"
          @click="activeTab = tab.id"
          :class="['tab-button', { active: activeTab === tab.id }]"
        >
          {{ tab.label }}
        </button>
      </div>

      <!-- Introducci√≥n -->
      <div v-if="activeTab === 'intro'" class="content-section">
        <h2>¬øQu√© son la Correlaci√≥n y la Regresi√≥n?</h2>
        <div class="theory-box">
          <h3>La Pregunta Principal</h3>
          <p>
            Imagina que eres due√±o de una tienda y te preguntas:
            <strong>"¬øEntre m√°s gasto en publicidad, m√°s vendo?"</strong> O quiz√°s te interesa
            saber:
            <strong>"¬øCu√°nto aumentar√°n mis ventas si invierto $1000 m√°s en publicidad?"</strong>
          </p>
          <p>
            El an√°lisis de <strong>correlaci√≥n y regresi√≥n</strong> te ayuda a responder estas
            preguntas cuando tienes dos variables num√©ricas que podr√≠an estar relacionadas.
          </p>

          <div class="concept-card">
            <h4>En T√©rminos Simples</h4>
            <p>
              <strong>Correlaci√≥n:</strong> Te dice si dos cosas est√°n relacionadas y qu√© tan fuerte
              es esa relaci√≥n.
            </p>
            <p>
              <strong>Regresi√≥n:</strong> Te da una f√≥rmula para predecir una cosa bas√°ndote en la
              otra.
            </p>
          </div>
        </div>

        <h2>Las Dos Variables en Juego</h2>
        <div class="theory-box">
          <p>Cuando analizamos la relaci√≥n entre dos variables, siempre tenemos:</p>

          <div class="concept-card">
            <h4>Variable Independiente (X) - La que controlas o conoces</h4>
            <p>Es la variable que <strong>usas para hacer la predicci√≥n</strong>. Por ejemplo:</p>
            <ul>
              <li>Horas de estudio ‚Üí Para predecir la calificaci√≥n</li>
              <li>A√±os de experiencia ‚Üí Para predecir el salario</li>
              <li>Inversi√≥n en publicidad ‚Üí Para predecir las ventas</li>
              <li>Temperatura ‚Üí Para predecir el consumo de helado</li>
            </ul>
            <p class="note">Se grafica en el <strong>eje horizontal (X)</strong></p>
          </div>

          <div class="concept-card">
            <h4>Variable Dependiente (Y) - La que quieres predecir</h4>
            <p>
              Es la variable que <strong>depende o podr√≠a ser afectada</strong> por la otra. Por
              ejemplo:
            </p>
            <ul>
              <li>Calificaci√≥n obtenida</li>
              <li>Salario</li>
              <li>Ventas</li>
              <li>Litros de helado vendidos</li>
            </ul>
            <p class="note">Se grafica en el <strong>eje vertical (Y)</strong></p>
          </div>
        </div>

        <h2>El Diagrama de Dispersi√≥n: Tu Primera Pista</h2>
        <div class="theory-box">
          <h3>¬øQu√© es?</h3>
          <p>
            Es un <strong>gr√°fico de puntos</strong> donde cada punto representa una observaci√≥n. Es
            como tomar una foto de tus datos para ver si existe alg√∫n patr√≥n.
          </p>

          <div class="concept-card">
            <h4>C√≥mo se hace</h4>
            <ol>
              <li>En el eje horizontal (X) colocas la variable independiente</li>
              <li>En el eje vertical (Y) colocas la variable dependiente</li>
              <li>Cada punto representa un par de valores (X, Y)</li>
            </ol>
            <p class="note">
              <strong>Ejemplo:</strong> Si tienes datos de 10 estudiantes con sus horas de estudio
              (X) y calificaci√≥n (Y), tendr√≠as 10 puntos en el gr√°fico.
            </p>
          </div>

          <h3>¬øQu√© puedes ver en el diagrama?</h3>
          <div class="grid-3">
            <div class="visual-item">
              <strong>Relaci√≥n Positiva</strong>
              <div id="plotPositive" class="mini-chart"></div>
              <p>Los puntos suben como una escalera de izquierda a derecha.</p>
              <p class="note">Significa: <em>Cuando X aumenta, Y tambi√©n aumenta</em></p>
              <p><strong>Ejemplo:</strong> M√°s horas de estudio ‚Üí Mayor calificaci√≥n</p>
            </div>
            <div class="visual-item">
              <strong>Relaci√≥n Negativa</strong>
              <div id="plotNegative" class="mini-chart"></div>
              <p>Los puntos bajan como un tobog√°n de izquierda a derecha.</p>
              <p class="note">Significa: <em>Cuando X aumenta, Y disminuye</em></p>
              <p><strong>Ejemplo:</strong> M√°s faltas a clase ‚Üí Menor calificaci√≥n</p>
            </div>
            <div class="visual-item">
              <strong>Sin Relaci√≥n</strong>
              <div id="plotNoRelation" class="mini-chart"></div>
              <p>Los puntos est√°n regados sin ning√∫n patr√≥n claro.</p>
              <p class="note">Significa: <em>X no afecta a Y</em></p>
              <p><strong>Ejemplo:</strong> Color de zapatos ‚Üí Calificaci√≥n</p>
            </div>
          </div>
        </div>

        <h2>Cuidado: ¬°Correlaci√≥n NO es Causalidad!</h2>
        <div class="theory-box">
          <div class="warning-box">
            <h3>La Trampa M√°s Com√∫n</h3>
            <p>
              <strong
                >Solo porque dos cosas est√©n relacionadas, NO significa que una causa la
                otra.</strong
              >
            </p>

            <h4>Ejemplos Curiosos (y Reales):</h4>
            <ul>
              <li>
                <strong>Ventas de helado vs Ahogamientos en piscinas</strong><br />
                Est√°n correlacionados, pero comer helado no causa ahogamientos. La causa real:
                <em>el verano (hace calor)</em>
              </li>
              <li>
                <strong>N√∫mero de pel√≠culas de Nicolas Cage vs Ahogamientos en piscinas</strong
                ><br />
                Tienen correlaci√≥n alta, pero obviamente no hay relaci√≥n causal. Es pura
                coincidencia.
              </li>
              <li>
                <strong>Tama√±o del pie vs Habilidad de lectura en ni√±os</strong><br />
                Est√°n correlacionados, pero el tama√±o del pie no te hace leer mejor. La variable
                oculta: <em>la edad</em>
              </li>
            </ul>
          </div>

          <div class="concept-card">
            <h4>Entonces, ¬øcu√°ndo s√≠ hay relaci√≥n causal?</h4>
            <p>Para afirmar que X <strong>causa</strong> Y, necesitas:</p>
            <ul>
              <li>Realizar experimentos controlados</li>
              <li>Tener una teor√≠a l√≥gica que lo explique</li>
              <li>Eliminar otras explicaciones posibles</li>
              <li>Que el efecto ocurra consistentemente</li>
            </ul>
            <p class="note">
              El an√°lisis de correlaci√≥n y regresi√≥n te dice <strong>"est√°n relacionadas"</strong>,
              pero NO te dice <strong>"una causa la otra"</strong>.
            </p>
          </div>
        </div>
      </div>

      <!-- Correlaci√≥n -->
      <div v-if="activeTab === 'correlacion'" class="content-section">
        <h2>El Coeficiente de Correlaci√≥n (r): Midiendo la Relaci√≥n</h2>
        <div class="theory-box">
          <h3>¬øQu√© es el Coeficiente de Correlaci√≥n?</h3>
          <p>Es un <strong>n√∫mero entre -1 y +1</strong> que te dice dos cosas importantes:</p>
          <ul>
            <li><strong>Qu√© tan fuerte</strong> es la relaci√≥n (el tama√±o del n√∫mero)</li>
            <li><strong>En qu√© direcci√≥n</strong> va la relaci√≥n (el signo + o -)</li>
          </ul>

          <div class="concept-card">
            <h4>El Coeficiente de Pearson (r)</h4>
            <p>
              Desarrollado por Karl Pearson, es la medida m√°s com√∫n. Piensa en √©l como
              <strong>una calificaci√≥n de qu√© tan bien relacionadas est√°n dos variables</strong>.
            </p>
          </div>
        </div>

        <h2>Entendiendo los Valores de r</h2>
        <div class="theory-box">
          <div class="concept-card">
            <h4>Los Extremos</h4>
            <ul>
              <li>
                <strong>r = +1.00</strong> ‚Üí Relaci√≥n perfecta positiva (todos los puntos en l√≠nea
                recta ascendente)
              </li>
              <li>
                <strong>r = -1.00</strong> ‚Üí Relaci√≥n perfecta negativa (todos los puntos en l√≠nea
                recta descendente)
              </li>
              <li>
                <strong>r = 0.00</strong> ‚Üí No hay relaci√≥n lineal (puntos totalmente dispersos)
              </li>
            </ul>
            <p class="note">
              <strong>En la pr√°ctica:</strong> Casi nunca ver√°s +1 o -1 perfectos. Los datos reales
              siempre tienen algo de variaci√≥n.
            </p>
          </div>

          <div class="formula-box">
            <h4>La F√≥rmula</h4>
            <div
              v-html="
                renderLatexDisplay('r = \\frac{\\sum(X - \\bar{X})(Y - \\bar{Y})}{(n - 1)s_x s_y}')
              "
            ></div>
            <p class="formula-note">
              Donde:<br />
              <strong><span v-html="renderLatex('\\bar{X}, \\bar{Y}')"></span>:</strong> Los
              promedios de X e Y<br />
              <strong><span v-html="renderLatex('s_x, s_y')"></span>:</strong> Las desviaciones
              est√°ndar<br />
              <strong>n:</strong> Cantidad de observaciones
            </p>
            <p class="note">
              <strong>Nota:</strong> Las calculadoras y software lo calculan por ti. Lo importante
              es saber interpretar el resultado.
            </p>
          </div>

          <h3>Gu√≠a de Interpretaci√≥n: ¬øQu√© significa cada valor?</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Valor de r</th>
                  <th>Fuerza</th>
                  <th>¬øQu√© significa?</th>
                  <th>Ejemplo cotidiano</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>0.00 a ¬±0.20</td>
                  <td>Muy d√©bil</td>
                  <td>Casi no hay relaci√≥n. No sirve para predecir.</td>
                  <td>Talla de camisa vs Nivel de ingl√©s</td>
                </tr>
                <tr>
                  <td>¬±0.20 a ¬±0.40</td>
                  <td>D√©bil</td>
                  <td>Hay algo de relaci√≥n, pero muy peque√±a.</td>
                  <td>Horas de TV vs Calificaciones</td>
                </tr>
                <tr>
                  <td>¬±0.40 a ¬±0.60</td>
                  <td>Moderada</td>
                  <td>Relaci√≥n notable. Puede ser √∫til para predecir.</td>
                  <td>Horas de ejercicio vs Peso perdido</td>
                </tr>
                <tr>
                  <td>¬±0.60 a ¬±0.80</td>
                  <td>Fuerte</td>
                  <td>Relaci√≥n clara. Buena para hacer predicciones.</td>
                  <td>A√±os de experiencia vs Salario</td>
                </tr>
                <tr>
                  <td>¬±0.80 a ¬±1.00</td>
                  <td>Muy fuerte</td>
                  <td>Relaci√≥n muy fuerte. Excelente predictor.</td>
                  <td>Altura de padres vs Altura de hijos</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="concept-card">
            <h4>Recuerda el Signo</h4>
            <p>
              <strong>Positivo (+):</strong> Ambas suben juntas. Ejemplo: r = +0.75<br />
              <strong>Negativo (-):</strong> Una sube, la otra baja. Ejemplo: r = -0.75<br />
              <em>¬°Ambos tienen la misma fuerza! Solo cambia la direcci√≥n.</em>
            </p>
          </div>
        </div>

        <h2>¬øEs Real la Correlaci√≥n o Solo Suerte?</h2>
        <div class="theory-box">
          <h3>El Problema</h3>
          <p>
            Sup√≥n que calculas r = 0.45 con una muestra de 15 personas.
            <strong>¬øEs esta correlaci√≥n real o solo casualidad?</strong> Necesitas hacer una
            <strong>prueba de significancia</strong> para estar seguro.
          </p>

          <div class="concept-card">
            <h4>La Pregunta Principal</h4>
            <p>
              <strong
                >¬øEsta correlaci√≥n que veo en mi muestra realmente existe en toda la poblaci√≥n, o es
                solo fruto del azar?</strong
              >
            </p>
          </div>

          <h3>Las Hip√≥tesis</h3>
          <ul>
            <li>
              <strong>H‚ÇÄ (Hip√≥tesis nula):</strong> <span v-html="renderLatex('\\rho = 0')"></span
              ><br />
              <em>"No hay correlaci√≥n en la poblaci√≥n. Lo que vi fue casualidad."</em>
            </li>
            <li>
              <strong>H‚ÇÅ (Hip√≥tesis alternativa):</strong>
              <span v-html="renderLatex('\\rho \\neq 0')"></span><br />
              <em>"S√≠ hay correlaci√≥n en la poblaci√≥n. Mi resultado es real."</em>
            </li>
          </ul>

          <div class="formula-box">
            <h4>Estad√≠stico de Prueba</h4>
            <div v-html="renderLatexDisplay('t = \\frac{r\\sqrt{n-2}}{\\sqrt{1-r^2}}')"></div>
            <p class="formula-note">
              Con <span v-html="renderLatex('n-2')"></span> grados de libertad<br />
              Donde <strong>n</strong> es tu tama√±o de muestra
            </p>
          </div>

          <div class="concept-card">
            <h4>C√≥mo Tomar la Decisi√≥n</h4>
            <p><strong>Paso 1:</strong> Calcular el estad√≠stico t con la f√≥rmula anterior</p>
            <p>
              <strong>Paso 2:</strong> Buscar el valor cr√≠tico
              <span v-html="renderLatex('t_{\\alpha/2}')"></span> en:
            </p>
            <ul>
              <li>
                <strong>Tabla t-Student</strong> con
                <span v-html="renderLatex('n-2')"></span> grados de libertad y nivel de
                significancia Œ± = 0.05
              </li>
              <li>O usar software (Excel: =T.INV.2T(0.05, n-2), R, Python, etc.)</li>
            </ul>
            <p><strong>Paso 3:</strong> Comparar:</p>
            <div class="decision-box">
              <p><strong>Si |t calculado| > t cr√≠tico:</strong></p>
              <p>
                ‚Üí Rechazamos H‚ÇÄ. La correlaci√≥n <strong>es estad√≠sticamente significativa</strong>
              </p>
              <p><strong>Si |t calculado| ‚â§ t cr√≠tico:</strong></p>
              <p>‚Üí No rechazamos H‚ÇÄ. La correlaci√≥n podr√≠a ser casualidad</p>
            </div>
            <p class="note">
              <strong>Ejemplo:</strong> Con n=15, grados de libertad = 13, Œ±=0.05, el valor cr√≠tico
              es t = 2.160.<br />
              Si tu t calculado = 2.5, entonces 2.5 > 2.160 ‚Üí Rechazas H‚ÇÄ (correlaci√≥n
              significativa)
            </p>
          </div>
        </div>
      </div>

      <!-- Ejemplo de Correlaci√≥n -->
      <div v-if="activeTab === 'ejemplo-correlacion'" class="content-section">
        <h2>Ejemplo Pr√°ctico: Calculando la Correlaci√≥n</h2>

        <div class="theory-box">
          <h3>El Problema</h3>
          <p>
            Un profesor quiere saber si existe relaci√≥n entre las
            <strong>horas de estudio</strong> y las <strong>calificaciones</strong>
            obtenidas por 8 estudiantes en un examen.
          </p>
        </div>

        <div class="theory-box">
          <h3>Datos Recopilados</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Estudiante</th>
                  <th>Horas de Estudio (X)</th>
                  <th>Calificaci√≥n (Y)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Ana</td>
                  <td>2</td>
                  <td>65</td>
                </tr>
                <tr>
                  <td>Bruno</td>
                  <td>4</td>
                  <td>75</td>
                </tr>
                <tr>
                  <td>Carlos</td>
                  <td>6</td>
                  <td>85</td>
                </tr>
                <tr>
                  <td>Diana</td>
                  <td>8</td>
                  <td>90</td>
                </tr>
                <tr>
                  <td>Elena</td>
                  <td>3</td>
                  <td>70</td>
                </tr>
                <tr>
                  <td>Franco</td>
                  <td>5</td>
                  <td>80</td>
                </tr>
                <tr>
                  <td>Gloria</td>
                  <td>7</td>
                  <td>88</td>
                </tr>
                <tr>
                  <td>Hugo</td>
                  <td>1</td>
                  <td>60</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="theory-box">
          <h3>Diagrama de Dispersi√≥n</h3>
          <div id="scatterCorrelation" class="chart-container"></div>
        </div>

        <div class="theory-box">
          <h3>Paso 1: Observar el Diagrama de Dispersi√≥n</h3>
          <p>
            En el gr√°fico podemos ver que los puntos forman un patr√≥n ascendente de izquierda a
            derecha. Esto sugiere una <strong>relaci√≥n positiva</strong>: a m√°s horas de estudio,
            mayor calificaci√≥n.
          </p>
        </div>

        <div class="theory-box">
          <h3>Paso 2: Calcular el Coeficiente de Correlaci√≥n (r)</h3>
          <p>Para calcular r, usamos la f√≥rmula:</p>
          <div class="formula-box">
            <div
              v-html="
                renderLatexDisplay('r = \\frac{\\sum(X - \\bar{X})(Y - \\bar{Y})}{(n - 1)s_x s_y}')
              "
            ></div>
          </div>

          <div class="solution-steps">
            <div class="step">
              <h4>C√°lculos necesarios:</h4>
              <ul>
                <li>
                  <strong>Promedio de X:</strong>
                  <span v-html="renderLatex('\\bar{X} = 4.5')"></span> horas
                </li>
                <li>
                  <strong>Promedio de Y:</strong>
                  <span v-html="renderLatex('\\bar{Y} = 76.625')"></span> puntos
                </li>
                <li>
                  <strong>Desviaci√≥n est√°ndar de X:</strong>
                  <span v-html="renderLatex('s_x = 2.33')"></span>
                </li>
                <li>
                  <strong>Desviaci√≥n est√°ndar de Y:</strong>
                  <span v-html="renderLatex('s_y = 10.93')"></span>
                </li>
              </ul>
            </div>

            <div class="result-box">
              <h4>Resultado:</h4>
              <p><strong>r = 0.978</strong></p>
            </div>
          </div>
        </div>

        <div class="theory-box">
          <h3>Paso 3: Interpretar el Resultado</h3>
          <div class="concept-card">
            <h4>¬øQu√© significa r = 0.978?</h4>
            <ul>
              <li>
                <strong>El valor es positivo:</strong> La relaci√≥n es directa (ambas variables
                aumentan juntas)
              </li>
              <li><strong>El valor est√° muy cerca de 1:</strong> La correlaci√≥n es muy fuerte</li>
              <li>
                <strong>Conclusi√≥n:</strong> Existe una relaci√≥n muy fuerte entre las horas de
                estudio y la calificaci√≥n obtenida
              </li>
            </ul>
            <p class="note">
              <strong>Importante:</strong> Esto NO significa que estudiar <em>causa</em> una mejor
              calificaci√≥n de forma autom√°tica, pero s√≠ existe una relaci√≥n muy clara entre ambas
              variables.
            </p>
          </div>
        </div>

        <div class="theory-box">
          <h3>Paso 4: Prueba de Significancia</h3>
          <p>¬øEs esta correlaci√≥n estad√≠sticamente significativa o podr√≠a ser casualidad?</p>

          <div class="formula-box">
            <h4>Estad√≠stico de prueba:</h4>
            <div
              v-html="
                renderLatexDisplay(
                  't = \\frac{r\\sqrt{n-2}}{\\sqrt{1-r^2}} = \\frac{0.978\\sqrt{8-2}}{\\sqrt{1-0.978^2}} = 11.58',
                )
              "
            ></div>
          </div>

          <div class="concept-card">
            <p>
              Con n-2 = 6 grados de libertad y un nivel de significancia de 0.05, el valor cr√≠tico
              es aproximadamente 2.447.
            </p>
            <p>
              <strong>Como t = 11.58 > 2.447, rechazamos H‚ÇÄ.</strong>
            </p>
            <p class="note">
              <strong>Conclusi√≥n:</strong> La correlaci√≥n es estad√≠sticamente significativa. No es
              producto del azar.
            </p>
          </div>
        </div>
      </div>

      <!-- Regresi√≥n -->
      <div v-if="activeTab === 'regresion'" class="content-section">
        <h2>Regresi√≥n Lineal: La M√°quina de Predicciones</h2>
        <div class="theory-box">
          <h3>¬øQu√© es la Regresi√≥n Lineal?</h3>
          <p>
            Si la <strong>correlaci√≥n</strong> te dice "estas dos cosas est√°n relacionadas", la
            <strong>regresi√≥n</strong> te dice
            <strong>"aqu√≠ est√° la f√≥rmula para hacer predicciones"</strong>.
          </p>

          <div class="concept-card">
            <h4>Objetivo Principal</h4>
            <p>
              Encontrar la <strong>mejor l√≠nea recta</strong> que pase lo m√°s cerca posible de todos
              tus puntos de datos. Esta l√≠nea te sirve para
              <strong>predecir valores futuros</strong>.
            </p>
            <p class="note">
              <strong>Ejemplo:</strong> Si tienes datos de publicidad vs ventas, la regresi√≥n te da
              una ecuaci√≥n para predecir cu√°nto vender√°s con cualquier cantidad de publicidad.
            </p>
          </div>
        </div>

        <h2>La Ecuaci√≥n de Regresi√≥n: Tu F√≥rmula M√°gica</h2>
        <div class="theory-box">
          <div class="highlight-box">
            <h3>La F√≥rmula de la Recta</h3>
            <div v-html="renderLatexDisplay('\\hat{Y} = a + bX')"></div>
          </div>

          <h3>Desglosando la F√≥rmula</h3>

          <div class="concept-card">
            <h4><span v-html="renderLatex('\\hat{Y}')"></span> (Y sombrero)</h4>
            <p>
              Es el <strong>valor que predices</strong>. Por ejemplo, si predices ventas,
              <span v-html="renderLatex('\\hat{Y}')"></span> ser√≠a "Ventas Estimadas".
            </p>
            <p class="note">El sombrero (ÀÜ) significa "estimado" o "predicho"</p>
          </div>

          <div class="concept-card">
            <h4>b (La Pendiente) - La parte m√°s importante</h4>
            <p>Te dice <strong>cu√°nto cambia Y cuando X aumenta en 1 unidad</strong>.</p>
            <div v-html="renderLatexDisplay('b = r\\left(\\frac{s_y}{s_x}\\right)')"></div>
            <p><strong>Ejemplos de interpretaci√≥n:</strong></p>
            <ul>
              <li>Si b = 5 ‚Üí "Por cada unidad que aumenta X, Y aumenta 5"</li>
              <li>Si b = -3 ‚Üí "Por cada unidad que aumenta X, Y disminuye 3"</li>
              <li>Si b = 0.5 ‚Üí "Por cada unidad que aumenta X, Y aumenta 0.5"</li>
            </ul>
          </div>

          <div class="concept-card">
            <h4>a (La Intersecci√≥n)</h4>
            <p>
              Es el <strong>valor de Y cuando X = 0</strong>. Es donde la l√≠nea cruza el eje
              vertical.
            </p>
            <div v-html="renderLatexDisplay('a = \\bar{Y} - b\\bar{X}')"></div>
            <p class="note">
              <strong>Importante:</strong> A veces "a" no tiene sentido en la pr√°ctica. Por ejemplo,
              si X es "a√±os de experiencia", ¬øqu√© significa "salario con 0 a√±os"? No te preocupes
              mucho por "a", enfocate en "b".
            </p>
          </div>
        </div>

        <h2>¬øC√≥mo Encuentra el Computador la "Mejor" Recta?</h2>
        <div class="theory-box">
          <h3>El M√©todo de M√≠nimos Cuadrados</h3>
          <p>
            Imagina que tienes muchos puntos en un gr√°fico. ¬øC√≥mo decides qu√© recta es la "mejor"?
            El <strong>principio de m√≠nimos cuadrados</strong> es el m√©todo matem√°tico que nos da la
            respuesta.
          </p>

          <div class="concept-card">
            <h4>Objetivo del M√©todo</h4>
            <p>
              Encontrar los valores de <strong>a</strong> (intersecci√≥n) y <strong>b</strong>
              (pendiente) que minimicen la suma de los cuadrados de las distancias verticales entre
              los puntos reales y la recta:
            </p>
            <div v-html="renderLatexDisplay('\\sum(Y - \\hat{Y})^2 = \\sum[Y - (a + bX)]^2')"></div>
            <p class="formula-note">
              Donde:<br />
              <strong>Y:</strong> Valores reales observados<br />
              <strong><span v-html="renderLatex('\\hat{Y}')"></span>:</strong> Valores estimados por
              la recta<br />
              <strong><span v-html="renderLatex('(Y - \\hat{Y})')"></span>:</strong> Residuales o
              errores de estimaci√≥n
            </p>
          </div>

          <div class="concept-card">
            <h4>El Proceso</h4>
            <ol>
              <li>El computador traza una recta entre los puntos</li>
              <li>
                Mide la <strong>distancia vertical</strong> de cada punto a la recta (el "error" o
                residual)
              </li>
              <li>Eleva al cuadrado todas esas distancias y las suma</li>
              <li>
                Busca la recta que hace que esta suma sea <strong>lo m√°s peque√±a posible</strong>
              </li>
            </ol>
            <p class="note">
              <strong>Importante:</strong> Las distancias son verticales porque estamos midiendo qu√©
              tan lejos est√° cada Y real del Y predicho por la recta.
            </p>
          </div>

          <div class="concept-card">
            <h4>¬øPor qu√© elevar al cuadrado?</h4>
            <ul>
              <li>
                <strong>Elimina el problema de signos:</strong> Los errores positivos y negativos no
                se cancelan entre s√≠
              </li>
              <li>
                <strong>Penaliza m√°s los errores grandes:</strong> Un error de 10 pesa m√°s que dos
                errores de 5
              </li>
              <li>
                <strong>Produce una soluci√≥n √∫nica:</strong> Es matem√°ticamente m√°s f√°cil de
                resolver y garantiza que encontremos LA mejor recta
              </li>
            </ul>
          </div>

          <h3>F√≥rmulas para Calcular M√≠nimos Cuadrados</h3>
          <div class="concept-card">
            <h4>Pendiente (b)</h4>
            <p>Hay dos formas de calcularla (dan el mismo resultado):</p>
            <div
              v-html="
                renderLatexDisplay(
                  'b = \\frac{\\sum(X - \\bar{X})(Y - \\bar{Y})}{\\sum(X - \\bar{X})^2}',
                )
              "
            ></div>
            <p>O la forma computacional (m√°s f√°cil con calculadora):</p>
            <div
              v-html="
                renderLatexDisplay(
                  'b = \\frac{n\\sum XY - \\sum X \\sum Y}{n\\sum X^2 - (\\sum X)^2}',
                )
              "
            ></div>
          </div>

          <div class="concept-card">
            <h4>Intersecci√≥n (a)</h4>
            <p>Una vez que tienes b, calculas a con:</p>
            <div v-html="renderLatexDisplay('a = \\bar{Y} - b\\bar{X}')"></div>
            <p class="note">
              <strong>Truco:</strong> Esta f√≥rmula garantiza que la recta siempre pase por el punto
              medio <span v-html="renderLatex('(\\bar{X}, \\bar{Y})')"></span>
            </p>
          </div>

          <h3>Propiedades de la Recta de M√≠nimos Cuadrados</h3>
          <div class="concept-card">
            <ol>
              <li>
                <strong>Pasa por el punto medio:</strong> La recta siempre cruza por
                <span v-html="renderLatex('(\\bar{X}, \\bar{Y})')"></span>
              </li>
              <li>
                <strong>Minimiza la suma de cuadrados:</strong> Ninguna otra recta tendr√≠a una suma
                menor
              </li>
              <li>
                <strong>Los residuales suman cero:</strong>
                <span v-html="renderLatex('\\sum(Y - \\hat{Y}) = 0')"></span>
              </li>
              <li>
                <strong>Es la mejor estimaci√≥n lineal:</strong> Seg√∫n el criterio de Gauss-Markov,
                es insesgada y de m√≠nima varianza
              </li>
            </ol>
          </div>

          <h3>Ejemplo: Comparando Diferentes Rectas</h3>
          <div class="concept-card">
            <p>
              Para nuestro ejemplo de llamadas vs ventas, si prob√°ramos diferentes rectas
              candidatas:
            </p>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Ecuaci√≥n</th>
                    <th>Suma de Cuadrados de Residuales</th>
                    <th>¬øEs la mejor?</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <span v-html="renderLatex('\\hat{Y} = 18.95 + 1.18X')"></span> (M√≠nimos
                      cuadrados)
                    </td>
                    <td><strong>784.21</strong></td>
                    <td>‚úì S√ç (m√≠nimo)</td>
                  </tr>
                  <tr>
                    <td><span v-html="renderLatex('\\hat{Y} = 19 + 1.2X')"></span></td>
                    <td>786.00</td>
                    <td>‚úó No</td>
                  </tr>
                  <tr>
                    <td><span v-html="renderLatex('\\hat{Y} = 20 + X')"></span></td>
                    <td>900.00</td>
                    <td>‚úó No</td>
                  </tr>
                  <tr>
                    <td><span v-html="renderLatex('\\hat{Y} = 15 + 1.5X')"></span></td>
                    <td>850.00</td>
                    <td>‚úó No</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <p class="note">
              <strong>Conclusi√≥n:</strong> La recta de m√≠nimos cuadrados tiene la suma m√°s peque√±a
              de cuadrados de residuales, por eso es la "mejor" recta de ajuste.
            </p>
          </div>
        </div>

        <h2>¬øQu√© tan Buena es tu Ecuaci√≥n de Regresi√≥n?</h2>
        <div class="theory-box">
          <p>
            Ya tienes tu ecuaci√≥n, pero <strong>¬øqu√© tan confiable es?</strong> Necesitas saber qu√©
            tan bien funciona.
          </p>

          <h3>R¬≤ (R Cuadrado) - Tu Calificaci√≥n de Predicci√≥n</h3>
          <div class="concept-card">
            <h4>¬øQu√© es?</h4>
            <p>
              Es un
              <strong
                >porcentaje que te dice qu√© tanto de la variaci√≥n en Y puedes explicar con X</strong
              >. Va de 0% a 100%.
            </p>
          </div>

          <div class="concept-card">
            <h4>Interpretaci√≥n F√°cil</h4>
            <ul>
              <li>
                <strong><span v-html="renderLatex('r^2 = 0.80')"></span> (80%):</strong><br />
                "El 80% de los cambios en Y se explican por X. El 20% restante es por otros factores
                que no mediste."
              </li>
              <li>
                <strong><span v-html="renderLatex('r^2 = 0.25')"></span> (25%):</strong><br />
                "Solo el 25% se explica por X. Hay muchas otras cosas afectando Y que no est√°s
                considerando."
              </li>
              <li>
                <strong><span v-html="renderLatex('r^2 = 0.95')"></span> (95%):</strong><br />
                "¬°Excelente! El 95% se explica por X. Tu modelo predice muy bien."
              </li>
            </ul>
          </div>

          <div class="concept-card">
            <h4>üìà ¬øQu√© es un "buen" R¬≤?</h4>
            <p>Depende del campo:</p>
            <ul>
              <li><strong>Ciencias f√≠sicas:</strong> R¬≤ > 0.90 es com√∫n</li>
              <li><strong>Negocios/Marketing:</strong> R¬≤ > 0.40 ya es √∫til</li>
              <li><strong>Ciencias sociales:</strong> R¬≤ > 0.30 puede ser aceptable</li>
            </ul>
            <p class="note">
              <strong>Regla general:</strong> R¬≤ > 0.50 significa que tu modelo es razonablemente
              bueno para hacer predicciones.
            </p>
          </div>
        </div>

        <h2>Error Est√°ndar: ¬øQu√© Tan Precisas Son Tus Predicciones?</h2>
        <div class="theory-box">
          <h3>¬øQu√© es?</h3>
          <p>
            Te dice <strong>cu√°nto se equivocan tus predicciones en promedio</strong>. Es como la
            "desviaci√≥n est√°ndar de los errores".
          </p>

          <div class="formula-box">
            <div
              v-html="
                renderLatexDisplay(
                  's_{y\\cdot x} = \\sqrt{\\frac{\\sum(Y_{real} - Y_{predicho})^2}{n-2}}',
                )
              "
            ></div>
          </div>

          <div class="concept-card">
            <h4>C√≥mo Interpretarlo</h4>
            <p><strong>Ejemplo pr√°ctico:</strong></p>
            <p>
              Si est√°s prediciendo ventas y tu error est√°ndar es <strong>s = 5</strong> unidades:
            </p>
            <ul>
              <li>Significa que tus predicciones se equivocan por 5 unidades en promedio</li>
              <li>Si predices 100 unidades, espera estar entre 90 y 110 aproximadamente</li>
              <li><strong>Mientras m√°s peque√±o sea s, mejores son tus predicciones</strong></li>
            </ul>
          </div>
        </div>

        <h2>Intervalos de Predicci√≥n: D√°ndole un Rango a tu Predicci√≥n</h2>
        <div class="theory-box">
          <h3>¬øPor qu√© usar intervalos?</h3>
          <p>
            Decir "vender√© exactamente 100 unidades" es muy arriesgado. Es mejor decir
            <strong>"vender√© entre 90 y 110 unidades con 95% de confianza"</strong>.
          </p>

          <div class="concept-card">
            <h4>La F√≥rmula</h4>
            <p>Para predecir un <strong>valor individual</strong> de Y:</p>
            <div
              v-html="
                renderLatexDisplay(
                  '\\hat{Y} \\pm t \\times s_{y\\cdot x} \\times \\sqrt{1 + \\frac{1}{n} + \\frac{(X-\\bar{X})^2}{\\sum(X-\\bar{X})^2}}',
                )
              "
            ></div>
          </div>

          <div class="concept-card">
            <h4>Algo Importante</h4>
            <p>El intervalo es <strong>m√°s ancho</strong> (menos preciso) cuando:</p>
            <ul>
              <li>Te alejas mucho del promedio de X</li>
              <li>Tu muestra es peque√±a</li>
            </ul>
            <p class="note">
              <strong>Moraleja:</strong> Las predicciones son m√°s confiables cuando est√°s dentro del
              rango de datos que usaste para crear el modelo.
            </p>
          </div>
        </div>
      </div>

      <!-- Ejemplo -->
      <div v-if="activeTab === 'ejemplo'" class="content-section">
        <h2>Ejemplo Pr√°ctico: Llamadas vs Ventas de Copiadoras</h2>

        <div class="theory-box">
          <h3>El Contexto</h3>
          <p>
            Una empresa de copiadoras quiere saber si existe relaci√≥n entre el
            <strong>n√∫mero de llamadas de ventas</strong> que hacen sus representantes y el
            <strong>n√∫mero de copiadoras vendidas</strong>.
          </p>
          <p>
            <strong>La pregunta clave:</strong> ¬øPuede la empresa predecir cu√°ntas copiadoras
            vender√° un representante bas√°ndose en cu√°ntas llamadas hace?
          </p>
        </div>

        <div class="example-grid">
          <div class="data-panel">
            <h3>Datos</h3>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Representante</th>
                    <th>Llamadas (X)</th>
                    <th>Ventas (Y)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(item, index) in exampleData" :key="index">
                    <td>{{ item.name }}</td>
                    <td>{{ item.x }}</td>
                    <td>{{ item.y }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="chart-panel">
            <h3>Diagrama de Dispersi√≥n y Recta de Regresi√≥n</h3>
            <div id="scatterPlot" class="chart-container"></div>
          </div>
        </div>

        <h3>Resultados del An√°lisis</h3>
        <div class="results-panel">
          <div class="result-card">
            <h4>1. Correlaci√≥n</h4>
            <p><strong>Coeficiente (r):</strong> {{ correlation.toFixed(3) }}</p>
            <div class="concept-card">
              <p><strong>¬øQu√© significa?</strong></p>
              <p v-if="Math.abs(correlation) >= 0.6">
                Existe una correlaci√≥n <strong>fuerte</strong>
                {{ correlation > 0 ? 'positiva' : 'negativa' }}.
                {{
                  correlation > 0 ? 'A m√°s llamadas, m√°s ventas.' : 'A m√°s llamadas, menos ventas.'
                }}
              </p>
              <p v-else-if="Math.abs(correlation) >= 0.4">
                Existe una correlaci√≥n <strong>moderada</strong>
                {{ correlation > 0 ? 'positiva' : 'negativa' }}. Hay relaci√≥n, pero no es muy
                fuerte.
              </p>
              <p v-else>
                La correlaci√≥n es <strong>d√©bil</strong>. Las llamadas no predicen bien las ventas.
              </p>
            </div>
          </div>

          <div class="result-card">
            <h4>2. Ecuaci√≥n de Regresi√≥n</h4>
            <div class="highlight-box">
              <div
                v-html="
                  renderLatexDisplay(`\\hat{Y} = ${intercept.toFixed(2)} + ${slope.toFixed(2)}X`)
                "
              ></div>
            </div>
            <div class="concept-card">
              <p><strong>¬øC√≥mo usarla?</strong></p>
              <p>
                <strong>Pendiente ({{ slope.toFixed(2) }}):</strong>
                Por cada llamada adicional, se venden aproximadamente
                <strong>{{ slope.toFixed(2) }} copiadoras m√°s</strong>.
              </p>
              <p>
                <strong>Ejemplo de predicci√≥n:</strong><br />
                Si un representante hace 25 llamadas:<br />
                Ventas estimadas = {{ intercept.toFixed(2) }} + {{ slope.toFixed(2) }} √ó 25 =
                <strong>{{ (intercept + slope * 25).toFixed(1) }} copiadoras</strong>
              </p>
            </div>
          </div>

          <div class="result-card">
            <h4>3. ¬øQu√© tan bueno es el modelo?</h4>
            <p>
              <strong>R¬≤ (Coeficiente de Determinaci√≥n):</strong>
              {{ rSquared.toFixed(3) }} (<strong>{{ (rSquared * 100).toFixed(1) }}%</strong>)
            </p>
            <div class="concept-card">
              <p><strong>Interpretaci√≥n:</strong></p>
              <p>
                El <strong>{{ (rSquared * 100).toFixed(1) }}%</strong> de la variaci√≥n en las ventas
                se explica por el n√∫mero de llamadas. El {{ (100 - rSquared * 100).toFixed(1) }}%
                restante se debe a otros factores (experiencia del vendedor, calidad del producto,
                suerte, etc.)
              </p>
              <p v-if="rSquared >= 0.7" class="note">
                <strong>¬°Excelente modelo!</strong> Puedes confiar en las predicciones.
              </p>
              <p v-else-if="rSquared >= 0.5" class="note">
                <strong>Buen modelo.</strong> Las predicciones son razonablemente confiables.
              </p>
              <p v-else-if="rSquared >= 0.3" class="note">
                <strong>Modelo moderado.</strong> √ösalo con precauci√≥n.
              </p>
              <p v-else class="note">
                <strong>Modelo d√©bil.</strong> No es muy confiable para predicciones.
              </p>
            </div>
            <p><strong>Error Est√°ndar:</strong> {{ stdError.toFixed(2) }} copiadoras</p>
            <div class="concept-card">
              <p><strong>¬øQu√© significa?</strong></p>
              <p>
                En promedio, tus predicciones se equivocan por ¬±{{ stdError.toFixed(2) }}
                copiadoras. Entonces, si predices 50 ventas, espera que el valor real est√© entre
                {{ (50 - stdError).toFixed(0) }} y {{ (50 + stdError).toFixed(0) }} aproximadamente.
              </p>
            </div>
          </div>
        </div>

        <h3>C√°lculos Detallados: Aplicando M√≠nimos Cuadrados</h3>
        <div class="theory-box">
          <h4>Tabla Completa de C√°lculos</h4>
          <p>
            Para aplicar el m√©todo de m√≠nimos cuadrados, necesitamos calcular algunas columnas
            adicionales:
          </p>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Representante</th>
                  <th>X</th>
                  <th>Y</th>
                  <th>X¬≤</th>
                  <th>Y¬≤</th>
                  <th>XY</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(item, index) in exampleData" :key="index">
                  <td>{{ item.name }}</td>
                  <td>{{ item.x }}</td>
                  <td>{{ item.y }}</td>
                  <td>{{ item.x * item.x }}</td>
                  <td>{{ item.y * item.y }}</td>
                  <td>{{ item.x * item.y }}</td>
                </tr>
                <tr class="total-row">
                  <td><strong>Total</strong></td>
                  <td>
                    <strong>{{ sumX }}</strong>
                  </td>
                  <td>
                    <strong>{{ sumY }}</strong>
                  </td>
                  <td>
                    <strong>{{ sumX2 }}</strong>
                  </td>
                  <td>
                    <strong>{{ sumY2 }}</strong>
                  </td>
                  <td>
                    <strong>{{ sumXY }}</strong>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <h4>Aplicando las F√≥rmulas de M√≠nimos Cuadrados</h4>
          <div class="concept-card">
            <p><strong>Paso 1: Calcular la pendiente (b)</strong></p>
            <div
              v-html="
                renderLatexDisplay(
                  'b = \\frac{n\\sum XY - \\sum X \\sum Y}{n\\sum X^2 - (\\sum X)^2}',
                )
              "
            ></div>
            <p>Sustituyendo los valores:</p>
            <div
              v-html="
                renderLatexDisplay(
                  `b = \\frac{${n}(${sumXY}) - (${sumX})(${sumY})}{${n}(${sumX2}) - (${sumX})^2}`,
                )
              "
            ></div>
            <div
              v-html="
                renderLatexDisplay(
                  `b = \\frac{${n * sumXY} - ${sumX * sumY}}{${n * sumX2} - ${sumX * sumX}} = \\frac{${n * sumXY - sumX * sumY}}{${n * sumX2 - sumX * sumX}} = ${slope.toFixed(4)}`,
                )
              "
            ></div>
          </div>

          <div class="concept-card">
            <p><strong>Paso 2: Calcular la intersecci√≥n (a)</strong></p>
            <div v-html="renderLatexDisplay('a = \\bar{Y} - b\\bar{X}')"></div>
            <p>Sustituyendo los valores:</p>
            <div
              v-html="
                renderLatexDisplay(
                  `a = ${meanY.toFixed(2)} - ${slope.toFixed(4)}(${meanX.toFixed(2)}) = ${intercept.toFixed(4)}`,
                )
              "
            ></div>
          </div>

          <div class="highlight-box">
            <p><strong>Ecuaci√≥n de Regresi√≥n Final:</strong></p>
            <div
              v-html="
                renderLatexDisplay(`\\hat{Y} = ${intercept.toFixed(2)} + ${slope.toFixed(2)}X`)
              "
            ></div>
          </div>
        </div>

        <h3>Verificaci√≥n: Calculando los Residuales</h3>
        <div class="theory-box">
          <p>
            Para verificar que nuestra recta es la mejor, calculamos los residuales (errores) para
            cada punto y comprobamos que su suma de cuadrados es m√≠nima:
          </p>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Representante</th>
                  <th>Y real</th>
                  <th>≈∂ estimado</th>
                  <th>Residual (Y-≈∂)</th>
                  <th>(Y-≈∂)¬≤</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(item, index) in exampleData" :key="index">
                  <td>{{ item.name }}</td>
                  <td>{{ item.y }}</td>
                  <td>{{ (intercept + slope * item.x).toFixed(2) }}</td>
                  <td>{{ (item.y - (intercept + slope * item.x)).toFixed(2) }}</td>
                  <td>{{ Math.pow(item.y - (intercept + slope * item.x), 2).toFixed(2) }}</td>
                </tr>
                <tr class="total-row">
                  <td colspan="3"><strong>Suma de Cuadrados de Residuales (SCR)</strong></td>
                  <td colspan="2">
                    <strong>{{ sumSquaredResiduals.toFixed(2) }}</strong>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="concept-card">
            <h4>Propiedad Fundamental</h4>
            <p>
              <strong
                >Ninguna otra recta tendr√≠a una suma de cuadrados de residuales menor que
                {{ sumSquaredResiduals.toFixed(2) }}</strong
              >. Esta es la recta √≥ptima seg√∫n el criterio de m√≠nimos cuadrados.
            </p>
            <p class="note">
              <strong>Nota:</strong> Si observas cuidadosamente, la suma de los residuales (columna
              Y-≈∂) es aproximadamente cero. Esto es una propiedad matem√°tica de la recta de m√≠nimos
              cuadrados.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch, nextTick, onMounted } from 'vue'
import * as katex from 'katex'
import 'katex/dist/katex.min.css'
import Plotly from 'plotly.js-dist-min'

const activeTab = ref('intro')

const tabs = [
  { id: 'intro', label: 'Introducci√≥n' },
  { id: 'correlacion', label: 'Correlaci√≥n' },
  { id: 'ejemplo-correlacion', label: 'Ejemplo Correlaci√≥n' },
  { id: 'regresion', label: 'Regresi√≥n' },
  { id: 'ejemplo', label: 'Ejemplo Completo' },
]

const exampleData = [
  { name: 'Tom Keller', x: 20, y: 30 },
  { name: 'Jeff Hall', x: 40, y: 60 },
  { name: 'Brian Virost', x: 20, y: 40 },
  { name: 'Greg Fish', x: 30, y: 60 },
  { name: 'Susan Welch', x: 10, y: 30 },
  { name: 'Carlos Ram√≠rez', x: 10, y: 40 },
  { name: 'Rich Niles', x: 20, y: 40 },
  { name: 'Mike Kiel', x: 20, y: 50 },
  { name: 'Mark Reynolds', x: 20, y: 30 },
  { name: 'Soni Jones', x: 30, y: 70 },
]

// C√°lculos
const n = computed(() => exampleData.length)
const sumX = computed(() => exampleData.reduce((acc, item) => acc + item.x, 0))
const sumY = computed(() => exampleData.reduce((acc, item) => acc + item.y, 0))
const sumXY = computed(() => exampleData.reduce((acc, item) => acc + item.x * item.y, 0))
const sumX2 = computed(() => exampleData.reduce((acc, item) => acc + item.x ** 2, 0))
const sumY2 = computed(() => exampleData.reduce((acc, item) => acc + item.y ** 2, 0))

const meanX = computed(() => sumX.value / n.value)
const meanY = computed(() => sumY.value / n.value)

// Pendiente (b)
const slope = computed(() => {
  const numerator = n.value * sumXY.value - sumX.value * sumY.value
  const denominator = n.value * sumX2.value - sumX.value ** 2
  return numerator / denominator
})

// Intersecci√≥n (a)
const intercept = computed(() => meanY.value - slope.value * meanX.value)

// Correlaci√≥n (r)
const correlation = computed(() => {
  const numerator = n.value * sumXY.value - sumX.value * sumY.value
  const denominator = Math.sqrt(
    (n.value * sumX2.value - sumX.value ** 2) * (n.value * sumY2.value - sumY.value ** 2),
  )
  return numerator / denominator
})

// R cuadrado
const rSquared = computed(() => correlation.value ** 2)

// Suma de cuadrados de residuales
const sumSquaredResiduals = computed(() => {
  return exampleData.reduce((acc, item) => {
    const yPred = intercept.value + slope.value * item.x
    return acc + (item.y - yPred) ** 2
  }, 0)
})

// Error est√°ndar
const stdError = computed(() => {
  return Math.sqrt(sumSquaredResiduals.value / (n.value - 2))
})

// Renderizado de gr√°ficos
const renderChart = () => {
  const xValues = exampleData.map((d) => d.x)
  const yValues = exampleData.map((d) => d.y)

  // Puntos de datos
  const trace1 = {
    x: xValues,
    y: yValues,
    mode: 'markers',
    type: 'scatter',
    name: 'Datos Observados',
    marker: { size: 10, color: '#3b82f6' },
  }

  // L√≠nea de regresi√≥n
  const xRange = [Math.min(...xValues) - 5, Math.max(...xValues) + 5]
  const yRange = xRange.map((x) => intercept.value + slope.value * x)

  const trace2 = {
    x: xRange,
    y: yRange,
    mode: 'lines',
    type: 'scatter',
    name: 'Recta de Regresi√≥n',
    line: { color: '#ef4444', width: 3 },
  }

  const layout = {
    title: { text: 'Relaci√≥n Llamadas vs Ventas' },
    xaxis: { title: { text: 'N√∫mero de Llamadas (X)' } },
    yaxis: { title: { text: 'Ventas de Copiadoras (Y)' } },
    showlegend: true,
    legend: { x: 0, y: 1 },
  }

  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  Plotly.newPlot('scatterPlot', [trace1, trace2] as any, layout, { responsive: true })
}

// Renderizado del gr√°fico de correlaci√≥n simple
const renderCorrelationChart = () => {
  const corrData = [
    { x: 2, y: 65 },
    { x: 4, y: 75 },
    { x: 6, y: 85 },
    { x: 8, y: 90 },
    { x: 3, y: 70 },
    { x: 5, y: 80 },
    { x: 7, y: 88 },
    { x: 1, y: 60 },
  ]

  const trace = {
    x: corrData.map((d) => d.x),
    y: corrData.map((d) => d.y),
    mode: 'markers',
    type: 'scatter',
    name: 'Estudiantes',
    marker: { size: 12, color: '#8b5cf6' },
  }

  const layout = {
    title: { text: 'Horas de Estudio vs Calificaci√≥n' },
    xaxis: { title: { text: 'Horas de Estudio (X)' } },
    yaxis: { title: { text: 'Calificaci√≥n (Y)' } },
    showlegend: false,
  }

  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  Plotly.newPlot('scatterCorrelation', [trace] as any, layout, { responsive: true })
}

// Renderizar mini gr√°ficos de ejemplo
const renderMiniCharts = () => {
  // Correlaci√≥n positiva (r ‚âà 0.9)
  const positiveData = {
    x: [1, 2, 3, 4, 5, 6, 7, 8],
    y: [2, 3.5, 4, 5.5, 6, 7.5, 8, 9],
  }

  const tracePositive = {
    x: positiveData.x,
    y: positiveData.y,
    mode: 'markers',
    type: 'scatter',
    marker: { size: 8, color: '#10b981' },
  }

  const layoutMini = {
    width: 200,
    height: 150,
    margin: { l: 30, r: 10, t: 10, b: 30 },
    xaxis: { showticklabels: false, showgrid: false },
    yaxis: { showticklabels: false, showgrid: false },
    showlegend: false,
  }

  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  Plotly.newPlot('plotPositive', [tracePositive] as any, layoutMini, {
    staticPlot: true,
    displayModeBar: false,
  })

  // Correlaci√≥n negativa (r ‚âà -0.9)
  const negativeData = {
    x: [1, 2, 3, 4, 5, 6, 7, 8],
    y: [9, 8, 7, 6, 5, 4, 3, 2],
  }

  const traceNegative = {
    x: negativeData.x,
    y: negativeData.y,
    mode: 'markers',
    type: 'scatter',
    marker: { size: 8, color: '#ef4444' },
  }

  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  Plotly.newPlot('plotNegative', [traceNegative] as any, layoutMini, {
    staticPlot: true,
    displayModeBar: false,
  })

  // Sin correlaci√≥n (r ‚âà 0)
  const noRelationData = {
    x: [1, 2, 3, 4, 5, 6, 7, 8],
    y: [5, 3, 7, 4, 6, 2, 5, 6],
  }

  const traceNoRelation = {
    x: noRelationData.x,
    y: noRelationData.y,
    mode: 'markers',
    type: 'scatter',
    marker: { size: 8, color: '#6b7280' },
  }

  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  Plotly.newPlot('plotNoRelation', [traceNoRelation] as any, layoutMini, {
    staticPlot: true,
    displayModeBar: false,
  })
}

watch(activeTab, (newTab) => {
  if (newTab === 'ejemplo') {
    nextTick(() => {
      renderChart()
    })
  } else if (newTab === 'ejemplo-correlacion') {
    nextTick(() => {
      renderCorrelationChart()
    })
  } else if (newTab === 'intro') {
    nextTick(() => {
      renderMiniCharts()
    })
  }
})

onMounted(() => {
  // Renderizar mini gr√°ficos al cargar si estamos en la pesta√±a intro (por defecto)
  if (activeTab.value === 'intro') {
    nextTick(() => {
      renderMiniCharts()
    })
  }
})

const renderLatex = (latex: string) => {
  try {
    return katex.renderToString(latex, { throwOnError: false })
  } catch {
    return latex
  }
}

const renderLatexDisplay = (latex: string) => {
  try {
    return katex.renderToString(latex, { throwOnError: false, displayMode: true })
  } catch {
    return latex
  }
}
</script>

<style scoped>
.correlacion-regresion-view {
  padding-bottom: 4rem;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.hero {
  text-align: center;
  margin-bottom: 3rem;
  background: var(--gradient-primary);
  padding: 4rem 2rem;
  border-radius: 1rem;
  color: white;
  box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.2);
}

.hero h1 {
  font-size: 2.5rem;
  margin-bottom: 1rem;
  font-weight: 800;
  letter-spacing: -0.025em;
  color: white;
}

.hero p {
  font-size: 1.25rem;
  opacity: 1;
  max-width: 600px;
  margin: 0 auto;
  color: white;
}

.tabs {
  display: flex;
  gap: 1rem;
  margin-bottom: 3rem;
  flex-wrap: wrap;
  justify-content: center;
  background: var(--surface);
  padding: 0.5rem;
  border-radius: 1rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  width: fit-content;
  margin-left: auto;
  margin-right: auto;
}

.tab-button {
  padding: 0.75rem 1.5rem;
  border: none;
  background: transparent;
  cursor: pointer;
  border-radius: 0.5rem;
  font-weight: 600;
  color: var(--text-secondary);
  transition: all 0.3s ease;
}

.tab-button:hover {
  color: var(--primary);
  background: var(--primary-50);
}

.tab-button.active {
  background: var(--primary);
  color: white;
  box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
}

.content-section {
  animation: fadeIn 0.5s ease;
}

.theory-box {
  background: var(--surface);
  padding: 2.5rem;
  border-radius: 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  margin-bottom: 2.5rem;
  border: 1px solid var(--border-light);
}

.theory-box h3 {
  color: var(--primary-800);
  margin-top: 2rem;
  margin-bottom: 1rem;
  font-size: 1.5rem;
}

.theory-box h3:first-child {
  margin-top: 0;
}

.formula-box {
  background: var(--neutral-50);
  padding: 2rem;
  border-radius: 1rem;
  margin: 2rem 0;
  text-align: center;
  border-left: 4px solid var(--primary);
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
}

.formula-note {
  margin-top: 1rem;
  font-size: 0.9rem;
  color: var(--text-secondary);
}

.concept-card {
  background: var(--primary-50);
  padding: 1.5rem;
  border-radius: 1rem;
  margin-top: 1.5rem;
  border: 1px solid var(--primary-100);
}

.warning-box {
  background: var(--accent-50);
  padding: 1.5rem;
  border-radius: 1rem;
  margin-top: 1.5rem;
  border: 1px solid var(--accent-100);
  color: var(--accent-900);
}

.warning-box h3 {
  color: var(--accent-700);
  margin-top: 0;
}

.highlight-box {
  background: var(--secondary-50);
  padding: 1.5rem;
  border-radius: 1rem;
  text-align: center;
  margin: 1.5rem 0;
  border: 1px solid var(--secondary-200);
}

.grid-3 {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.visual-item {
  background: white;
  padding: 1rem;
  border-radius: 0.5rem;
  text-align: center;
  border: 1px solid var(--border);
}

.visual-item strong {
  display: block;
  color: var(--primary);
  margin-bottom: 0.5rem;
}

.definition-list li {
  margin-bottom: 1rem;
  padding-left: 1rem;
  border-left: 3px solid var(--secondary-300);
}

.table-container {
  overflow-x: auto;
  margin: 2rem 0;
  border-radius: 1rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
}

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

th,
td {
  padding: 1.25rem;
  text-align: left;
  border-bottom: 1px solid var(--border);
}

th {
  background: var(--neutral-50);
  font-weight: 700;
  color: var(--text-primary);
  text-transform: uppercase;
  font-size: 0.85rem;
  letter-spacing: 0.05em;
}

tr:last-child td {
  border-bottom: none;
}

.total-row {
  background: var(--primary-50);
  font-weight: 700;
  border-top: 2px solid var(--primary);
}

.total-row td {
  color: var(--primary);
  font-size: 1rem;
}

.example-grid {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  margin-bottom: 2rem;
}

.chart-container {
  width: 100%;
  height: 520px;
  background: white;
  border-radius: 1rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  border: 1px solid var(--border);
  /* padding: 1rem; */
}

.results-panel {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
}

.results-panel + .result-card,
.content-section h3 + .results-panel {
  margin-top: 1.5rem;
}

.result-card {
  background: var(--surface);
  padding: 2rem;
  border-radius: 1rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  border-top: 4px solid var(--secondary);
  transition: transform 0.3s ease;
}

.result-card:hover {
  transform: translateY(-5px);
}

.result-card h4 {
  color: var(--text-primary);
  margin-bottom: 1rem;
  font-size: 1.2rem;
}

@media (max-width: 1024px) {
  .example-grid {
    flex-direction: column;
  }
}

@media (max-width: 768px) {
  .hero {
    padding: 3rem 1.5rem;
  }

  .hero h1 {
    font-size: 2rem;
  }

  .theory-box {
    padding: 1.5rem;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.mini-chart {
  width: 200px;
  height: 150px;
  border: 1px solid var(--border);
  border-radius: 0.5rem;
  background: white;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.decision-box {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 1.5rem;
  border-radius: 0.75rem;
  margin-top: 1rem;
  box-shadow: 0 4px 6px rgba(102, 126, 234, 0.25);
}

.decision-box h4 {
  margin-bottom: 0.75rem;
  font-size: 1.1rem;
}

.decision-box p {
  margin-bottom: 0.5rem;
  line-height: 1.6;
}
</style>
